/* Tiny tinycomments plugin
*
* Copyright 2010-2018 Tiny Technologies Inc. All rights reserved.
*
* Version: 2.1.1-89
*/
!function(d){"use strict";var h=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return h(t())}}},s=function(){},p=function(t,o){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(o.apply(null,n))}},_=function(n){return function(){return n}},n=function(n){return n};var e,t,o,r,i,g,u,c=_(!1),a=_(!0),f=c,m=a,l=function(){return v},v=(r={fold:function(n,e){return n()},is:f,isSome:f,isNone:m,getOr:o=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:o,orThunk:t,map:l,ap:l,each:function(){},bind:l,flatten:l,exists:f,forall:m,filter:l,equals:e=function(n){return n.isNone()},equals_:e,toArray:function(){return[]},toString:_("none()")},Object.freeze&&Object.freeze(r),r),y=function(t){var n=function(){return t},e=function(){return r},o=function(n){return n(t)},r={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:m,isNone:f,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return y(n(t))},ap:function(n){return n.fold(l,function(n){return y(n(t))})},each:function(n){n(t)},bind:o,flatten:n,exists:o,forall:o,filter:function(n){return n(t)?r:v},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(f,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return r},w={some:y,none:l,from:function(n){return null==n?v:y(n)}},b=function(n){return parseInt(n,10)},O=function(n,e,t){return{major:n,minor:e,patch:t}},S=function(n){var e=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(n);return e?O(b(e[1]),b(e[2]),b(e[3])):O(0,0,0)},D=function(n,e){var t=n-e;return 0===t?0:0<t?1:-1},C=function(n,e){var t=D(n.major,e.major);if(0!==t)return t;var o=D(n.minor,e.minor);if(0!==o)return o;var r=D(n.patch,e.patch);return 0!==r?r:0},E=function(n){return S([(e=n).majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."));var e},T=function(n,e){return!!n&&-1===C(E(n),S(e))},x=0,A=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++x+String(e)},N=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}},k=N("string"),M=N("object"),j=N("boolean"),R=N("function"),U=N("number"),L=Array.prototype.slice,I=void 0===(i=Array.prototype.indexOf)?function(n,e){return V(n,e)}:function(n,e){return i.call(n,e)},P=function(n,e){for(var t=n.length,o=new Array(t),r=0;r<t;r++){var i=n[r];o[r]=e(i,r,n)}return o},F=function(n,e){for(var t=0,o=n.length;t<o;t++){e(n[t],t,n)}},B=function(n,e){for(var t=[],o=0,r=n.length;o<r;o++){var i=n[o];e(i,o,n)&&t.push(i)}return t},H=function(n,e){for(var t=0,o=n.length;t<o;t++){var r=n[t];if(e(r,t,n))return w.some(r)}return w.none()},V=function(n,e){for(var t=0,o=n.length;t<o;++t)if(n[t]===e)return t;return-1},Y=(R(Array.from)&&Array.from,Object.keys),q=Object.hasOwnProperty,X=function(n,e){for(var t=Y(n),o=0,r=t.length;o<r;o++){var i=t[o];e(n[i],i,n)}},W=function(n,o){return z(n,function(n,e,t){return{k:e,v:o(n,e,t)}})},z=function(o,r){var i={};return X(o,function(n,e){var t=r(n,e,o);i[t.k]=t.v}),i},G=(d.Node.ATTRIBUTE_NODE,d.Node.CDATA_SECTION_NODE,d.Node.COMMENT_NODE),J=d.Node.DOCUMENT_NODE,$=(d.Node.DOCUMENT_TYPE_NODE,d.Node.DOCUMENT_FRAGMENT_NODE,d.Node.ELEMENT_NODE),K=(d.Node.TEXT_NODE,d.Node.PROCESSING_INSTRUCTION_NODE,d.Node.ENTITY_REFERENCE_NODE,d.Node.ENTITY_NODE,d.Node.NOTATION_NODE,function(n,e,t){if(!(k(t)||j(t)||U(t)))throw d.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}),Q=function(n,e,t){K(n.dom(),e,t)},Z=function(n,e){n.dom().removeAttribute(e)},nn=function(t){var o,r=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return r||(r=!0,o=t.apply(null,n)),o}},en=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:_(n)}},tn={fromHtml:function(n,e){var t=(e||d.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw d.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return en(t.childNodes[0])},fromTag:function(n,e){var t=(e||d.document).createElement(n);return en(t)},fromText:function(n,e){var t=(e||d.document).createTextNode(n);return en(t)},fromDom:en,fromPoint:function(n,e,t){var o=n.dom();return w.from(o.elementFromPoint(e,t)).map(en)}},on=nn(function(){return rn(tn.fromDom(d.document))}),rn=function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return tn.fromDom(e)},un=function(n,e){return-1!==n.indexOf(e)},cn=function(n,e,t){if(!k(t))throw d.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);var o;void 0!==(o=n).style&&R(o.style.getPropertyValue)&&n.style.setProperty(e,t)},an=void 0!==d.window?d.window:Function("return this;")(),sn=function(n,e){return function(n,e){for(var t=null!=e?e:an,o=0;o<n.length&&null!=t;++o)t=t[n[o]];return t}(n.split("."),e)},fn={getOrDie:function(n,e){var t=sn(n,e);if(null==t)throw new Error(n+" not available on this browser");return t}},dn=function(){return fn.getOrDie("Node")},mn=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},ln=function(n,e){return mn(n,e,dn().DOCUMENT_POSITION_CONTAINED_BY)},vn=function(){return hn(0,0)},hn=function(n,e){return{major:n,minor:e}},pn={nu:hn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?vn():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var o=n[t];if(o.test(e))return o}}(n,e);if(!t)return{major:0,minor:0};var o=function(n){return Number(e.replace(t,"$"+n))};return hn(o(1),o(2))}(n,t)},unknown:vn},_n="Firefox",gn=function(n,e){return function(){return e===n}},yn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:gn("Edge",e),isChrome:gn("Chrome",e),isIE:gn("IE",e),isOpera:gn("Opera",e),isFirefox:gn(_n,e),isSafari:gn("Safari",e)}},wn={unknown:function(){return yn({current:void 0,version:pn.unknown()})},nu:yn,edge:_("Edge"),chrome:_("Chrome"),ie:_("IE"),opera:_("Opera"),firefox:_(_n),safari:_("Safari")},bn="Windows",On="Android",Sn="Solaris",Dn="FreeBSD",Cn=function(n,e){return function(){return e===n}},En=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Cn(bn,e),isiOS:Cn("iOS",e),isAndroid:Cn(On,e),isOSX:Cn("OSX",e),isLinux:Cn("Linux",e),isSolaris:Cn(Sn,e),isFreeBSD:Cn(Dn,e)}},Tn={unknown:function(){return En({current:void 0,version:pn.unknown()})},nu:En,windows:_(bn),ios:_("iOS"),android:_(On),linux:_("Linux"),osx:_("OSX"),solaris:_(Sn),freebsd:_(Dn)},xn=function(n,e){var t=String(e).toLowerCase();return H(n,function(n){return n.search(t)})},An=function(n,t){return xn(n,t).map(function(n){var e=pn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Nn=function(n,t){return xn(n,t).map(function(n){var e=pn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},kn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Mn=function(e){return function(n){return un(n,e)}},jn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return un(n,"edge/")&&un(n,"chrome")&&un(n,"safari")&&un(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,kn],search:function(n){return un(n,"chrome")&&!un(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return un(n,"msie")||un(n,"trident")}},{name:"Opera",versionRegexes:[kn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Mn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Mn("firefox")},{name:"Safari",versionRegexes:[kn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(un(n,"safari")||un(n,"mobile/"))&&un(n,"applewebkit")}}],Rn=[{name:"Windows",search:Mn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return un(n,"iphone")||un(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Mn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Mn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Mn("linux"),versionRegexes:[]},{name:"Solaris",search:Mn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Mn("freebsd"),versionRegexes:[]}],Un={browsers:_(jn),oses:_(Rn)},Ln=function(n){var e,t,o,r,i,u,c,a,s,f,d,m=Un.browsers(),l=Un.oses(),v=An(m,n).fold(wn.unknown,wn.nu),h=Nn(l,n).fold(Tn.unknown,Tn.nu);return{browser:v,os:h,deviceType:(t=v,o=n,r=(e=h).isiOS()&&!0===/ipad/i.test(o),i=e.isiOS()&&!r,u=e.isAndroid()&&3===e.version.major,c=e.isAndroid()&&4===e.version.major,a=r||u||c&&!0===/mobile/i.test(o),s=e.isiOS()||e.isAndroid(),f=s&&!a,d=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(o),{isiPad:_(r),isiPhone:_(i),isTablet:_(a),isPhone:_(f),isTouch:_(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:_(d)})}},In={detect:nn(function(){var n=d.navigator.userAgent;return Ln(n)})},Pn=$,Fn=J,Bn=function(n){return n.nodeType!==Pn&&n.nodeType!==Fn||0===n.childElementCount},Hn=(In.detect().browser.isIE(),function(n){return tn.fromDom(n.dom().ownerDocument)}),Vn=function(n){var e=n.dom();return P(e.childNodes,tn.fromDom)},Yn=(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]}("element","offset"),function(e,t){var n;(n=e.dom(),w.from(n.parentNode).map(tn.fromDom)).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),qn=function(n,e){n.dom().appendChild(e.dom())},Xn=function(n){n.dom().textContent="",F(Vn(n),function(n){Wn(n)})},Wn=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},zn=function(n){var e,t=Vn(n);0<t.length&&(e=n,F(t,function(n){Yn(e,n)})),Wn(n)},Gn=function(n,e){var t,o,r,i=Hn(n).dom(),u=tn.fromDom(i.createDocumentFragment()),c=(t=e,(o=(i||d.document).createElement("div")).innerHTML=t,Vn(tn.fromDom(o)));r=u,F(c,function(n){qn(r,n)}),Xn(n),qn(n,u)},Jn=function(n,e){return t=e,r=void 0===(o=n)?d.document:o.dom(),Bn(r)?w.none():w.from(r.querySelector(t)).map(tn.fromDom);var t,o,r},$n=In.detect().os.isOSX()?"⌘":"Ctrl",Kn=W({tc_menu_name:"TinyComments",tc_announce_sidebar_available:"Comment. Sidebar available. Press "+$n+" + Alt + M to switch to sidebar",tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_save:"Save",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Say something ...",tc_kebab_deleteconversation:"Delete conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the Console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_create_problem:"An error occurred while creating a comment. See the Console for details",tc_reply_problem:"An error occurred while replying to a comment. See the Console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_delete_problem_all:"An error occurred deleting all the conversations. See the Console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the Console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the Console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},n),Qn=A("aria-comment-description"),Zn=function(n){var e,t,o=Jn(on(),"#"+Qn).getOrThunk(function(){var n,t,e=tn.fromTag("span");return Q(e,"id",Qn),Q(e,"aria-live","polite"),Q(e,"aria-atomic","true"),Q(e,"role","alert"),n={position:"absolute",left:"-10000px",top:"-1000px"},t=e.dom(),X(n,function(n,e){cn(t,e,n)}),qn(on(),e),e});return e=n,t=o,{onComment:function(){Gn(t,e.translate(Kn.tc_announce_sidebar_available))},notOnComment:function(){Gn(t,"")},getMarker:function(){return t}}},ne=function(o,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.console;t&&r in t&&t[r].apply(t,arguments)}},ee={log:ne(d.window,"log"),error:ne(d.window,"error"),warn:ne(d.window,"warm")},te=function(n){var t=w.none(),e=[],o=function(n){r()?u(n):e.push(n)},r=function(){return t.isSome()},i=function(n){F(n,u)},u=function(e){t.each(function(n){d.setTimeout(function(){e(n)},0)})};return n(function(n){t=w.some(n),i(e),e=[]}),{get:o,map:function(t){return te(function(e){o(function(n){e(t(n))})})},isReady:r}},oe={nu:te,pure:function(e){return te(function(n){n(e)})}},re=function(e){var n=function(n){var o;e((o=n,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this;d.setTimeout(function(){o.apply(t,n)},0)}))},t=function(){return oe.nu(n)};return{map:function(o){return re(function(t){n(function(n){var e=o(n);t(e)})})},bind:function(t){return re(function(e){n(function(n){t(n).get(e)})})},anonBind:function(t){return re(function(e){n(function(n){t.get(e)})})},toLazy:t,toCached:function(){var e=null;return re(function(n){null===e&&(e=t()),e.get(n)})},get:n}},ie={nu:re,pure:function(e){return re(function(n){n(e)})}},ue=function(u,n){return n(function(o){var r=[],i=0;0===u.length?o([]):F(u,function(n,e){var t;n.get((t=e,function(n){r[t]=n,++i>=u.length&&o(r)}))})})},ce=function(n){return ue(n,ie.nu)},ae=function(l,v){return function(n){if(l(n)){var e,t,o,r,i,u,c,a=tn.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},d=p(f,s),m=(e=a,t=n.clientX,o=n.clientY,r=s,i=f,u=d,c=n,{target:_(e),x:_(t),y:_(o),stop:r,prevent:i,kill:u,raw:_(c)});v(m)}}},se=function(n,e,t,o){return r=n,i=e,u=!1,c=ae(t,o),r.dom().addEventListener(i,c,u),{unbind:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=r.concat(n);return o.apply(null,t)}}(fe,r,i,c,u)};var r,i,u,c},fe=function(n,e,t,o){n.dom().removeEventListener(e,t,o)},de=_(!0),me=function(n,e,t){return se(n,e,de,t)},le=h(w.none()),ve="_tinycomments_sidebar",he=function(r){return ie.nu(function(n){var e,t,o=tn.fromTag("link");e={rel:"stylesheet",href:r},t=o.dom(),X(e,function(n,e){K(t,e,n)}),me(o,"load",function(){n()}),qn(tn.fromDom(d.document.head),o)})},pe=function(e){return le.get().getOrThunk(function(){var n=ie.nu(function(n){tinymce[ve]=n,ce(P(e,function(n){return("js"===n.type?function(t){return ie.nu(function(n){var e=tn.fromTag("script");Q(e,"src",t),me(e,"load",function(){n()}),qn(on(),e)})}:he)(n.filename)})).get(s)}).toLazy();return le.set(w.some(n)),n})};(u=g||(g={}))[u.Modern=0]="Modern",u[u.Silver=1]="Silver";var _e,ge=function(n,e){return t=e,r=void 0===(o=n)?d.document:o.dom(),Bn(r)?[]:P(r.querySelectorAll(t),tn.fromDom);var t,o,r},ye=_("tox-comment"),we=_("data-mce-annotation-uid"),be=_("data-mce-annotation"),Oe=_("tinycomments"),Se=_("tox-comments-visible"),De=function(n,e,t,o){return Gn(n,e),F(ge(n,t),o),n.dom().innerHTML},Ce=function(o,r,i){for(var u=tn.fromTag("div"),n=function(t){o[t].content=De(u,o[t].content,r,i),F(o[t].fragments||[],function(n,e){o[t].fragments[e]=De(u,o[t].fragments[e],r,i)})},e=0;e<o.length;e++)n(e)},Ee=function(n,e){var t;Ce(n,(t=e,"["+we()+'="'+t+'"]'),zn)},Te=function(n){Ce(n,"["+be()+'="'+Oe()+'"]',zn)},xe="tc-open-comment",Ae="tc-try-delete-all-conversations",Ne="tc-delete-conversation-at-cursor",ke=function(o,r,t){var i=Oe();o.addCommand(Ae,function(n,e){o.windowManager.confirm(Kn.tc_delete_prompts_all,function(n){if(n)return t.deleteAllConversations({}).get(function(n){n.fold(function(n){return r.showError(Kn.tc_delete_problem_all,n)},function(n){if(n.canDelete){var e=o.selection.getBookmark();o.focus();var t=o.annotator.getAll(i);X(t,function(n,e){var t;(t=n,0===t.length?w.none():w.some(t[0])).each(function(n){o.selection.select(n),o.annotator.remove(i)})}),o.selection.moveToBookmark(e),Te(o.undoManager.data),r.refreshSidebar(w.none(),2),o.focus()}else r.showError(Kn.tc_delete_unauthorised_all)})})})})},Me=function(n,e,u,c){n.on("init",function(){var o,r,t,i;o=e,r=c,n.addCommand(xe,function(n,e){var t=r.get();o.refreshSidebar(t,e.grabFocus?1:0)}),i=e,(t=n).addCommand(Ne,function(n,e){t.undoManager.transact(function(){return t.annotator.remove(Oe())}),Ee(t.undoManager.data,e.conversationUid),i.refreshSidebar(w.none(),2),t.focus()}),ke(n,e,u)})},je=function(n,e){return n.execCommand(xe,null,{grabFocus:e})},Re=function(n){n.execCommand(Ae,null,{})},Ue=function(n,e){n.execCommand("ToggleSidebar",null,e)},Le=function(){return(Le=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)},Ie=function(t){return{is:function(n){return t===n},isValue:a,isError:c,getOr:_(t),getOrThunk:_(t),getOrDie:_(t),or:function(n){return Ie(t)},orThunk:function(n){return Ie(t)},fold:function(n,e){return e(t)},map:function(n){return Ie(n(t))},mapError:function(n){return Ie(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return w.some(t)}}},Pe=function(t){return{is:c,isValue:c,isError:a,getOr:n,getOrThunk:function(n){return n()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return Pe(t)},mapError:function(n){return Pe(n(t))},each:s,bind:function(n){return Pe(t)},exists:c,forall:a,toOption:w.none}},Fe={value:Ie,error:Pe,fromOption:function(n,e){return n.fold(function(){return Pe(e)},Ie)}},Be=function(i){return Le({},i,{toCached:function(){return Be(i.toCached())},bindFuture:function(e){return Be(i.bind(function(n){return n.fold(function(n){return ie.pure(Fe.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Be(i.map(function(n){return n.bind(e)}))},mapResult:function(e){return Be(i.map(function(n){return n.map(e)}))},mapError:function(e){return Be(i.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return i.map(function(n){return n.fold(e,t)})},withTimeout:function(n,r){return Be(ie.nu(function(e){var t=!1,o=d.setTimeout(function(){t=!0,e(Fe.error(r()))},n);i.get(function(n){t||(d.clearTimeout(o),e(n))})}))}})},He=function(n){return Be(ie.nu(n))},Ve=function(n){return Be(ie.pure(Fe.value(n)))},Ye=He,qe=Ve,Xe=function(n){return Be(ie.pure(Fe.error(n)))},We=function(t){return function(n){return Ye(function(e){return t(n,function(n){e(Fe.value(n))},function(n){e(Fe.error(n))})})}},ze=function(t){return function(n){var e=n.settings[t];if(R(e))return e;throw new Error(t+" has not been implemented.")}},Ge=function(o,r){return function(n){return e=n.settings,t=o,q.call(e,t)?n.settings[o]:r(n);var e,t}},Je=function(t,o){return function(n){var e=Ge(t,function(){return o(ot(n))})(n);return We(e)}},$e=ze("tinycomments_create"),Ke=ze("tinycomments_reply"),Qe=ze("tinycomments_delete"),Ze=ze("tinycomments_delete_all"),nt=ze("tinycomments_delete_comment"),et=ze("tinycomments_edit_comment"),tt=ze("tinycomments_lookup"),ot=Ge("tinycomments_author",function(){return"Anon"}),rt=Ge("tinycomments_author_name",ot),it=Je("tinycomments_can_delete",function(o){return function(n,e,t){e({canDelete:0<n.comments.length&&n.comments[0].author===o&&!0})}}),ut=Je("tinycomments_can_delete_comment",function(o){return function(n,e,t){e({canDelete:n.comment.author===o&&!0})}}),ct=Je("tinycomments_can_edit_comment",function(o){return function(n,e,t){e({canEdit:n.comment.author===o&&!0})}}),at=Ge("tinycomments_mode",function(){return"callback"}),st=Object.prototype.hasOwnProperty,ft=(_e=function(n,e){return M(n)&&M(e)?ft(n,e):e},function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},o=0;o<n.length;o++){var r=n[o];for(var i in r)st.call(r,i)&&(t[i]=_e(t[i],r[i]))}return t}),dt=function(n){var o,e=$e(n),t=Ke(n),r=tt(n),i=Qe(n),u=Ze(n),c=nt(n),a=et(n);return{create:We(e),reply:We(t),lookup:We((o=r,function(n,t,e){o(n,function(n){var e=P(n.conversation.comments,function(n){return Le({authorName:n.author},n)});t(ft(n,{conversation:{comments:e}}))},e)})),deleteConversation:We(i),deleteAllConversations:We(u),editComment:We(a),deleteComment:We(c),lifecycleHooks:{onSetContent:s,onGetContent:w.none}}},mt=function(e){return function(n){return{uid:n.uid,comments:B(n.comments,function(n){return n.uid!==e})}}},lt=function(e,t,o){return function(n){return{uid:n.uid,comments:P(n.comments,function(n){return n.uid===e?Le({},n,{content:t,modifiedAt:o}):n})}}},vt=function(){return fn.getOrDie("JSON")},ht=function(n){return vt().parse(n)};var pt,_t,gt,yt,wt,bt=(pt=function(n){return n.dom().nodeType===G||"#comment"===n.dom().nodeName.toLowerCase()},_t="comment",gt=function(n){return pt(n)?w.from(n.dom().nodeValue):w.none()},yt=In.detect().browser,{get:function(n){if(!pt(n))throw new Error("Can only get "+_t+" value of a "+_t+" node");return wt(n).getOr("")},getOption:wt=yt.isIE()&&10===yt.version.major?function(n){try{return gt(n)}catch(n){return w.none()}}:gt,set:function(n,e){if(!pt(n))throw new Error("Can only set raw "+_t+" value of a "+_t+" node");n.dom().nodeValue=e}});var Ot=function(n){return fn.getOrDie("atob")(n)};window.Promise?window.Promise:function(){var i=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(n,t(r,this),t(c,this))},n=i.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){d.setTimeout(n,1)};function t(n,e){return function(){return n.apply(e,arguments)}}var o=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function u(t){var o=this;null!==this._state?n(function(){var n=o._state?t.onFulfilled:t.onRejected;if(null!==n){var e;try{e=n(o._value)}catch(n){return void t.reject(n)}t.resolve(e)}else(o._state?t.resolve:t.reject)(o._value)}):this._deferreds.push(t)}function r(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void f(t(e,n),t(r,this),t(c,this))}this._state=!0,this._value=n,a.call(this)}catch(n){c.call(this,n)}}function c(n){this._state=!1,this._value=n,a.call(this)}function a(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];u.call(this,t)}this._deferreds=[]}function s(n,e,t,o){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=o}function f(n,e,t){var o=!1;try{n(function(n){o||(o=!0,e(n))},function(n){o||(o=!0,t(n))})}catch(n){if(o)return;o=!0,t(n)}}i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(t,o){var r=this;return new i(function(n,e){u.call(r,new s(t,o,n,e))})},i.all=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var c=Array.prototype.slice.call(1===n.length&&o(n[0])?n[0]:n);return new i(function(o,r){if(0===c.length)return o([]);var i=c.length;function u(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){u(e,n)},r)}c[e]=n,0==--i&&o(c)}catch(n){r(n)}}for(var n=0;n<c.length;n++)u(n,c[n])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(n){n(e)})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(r){return new i(function(n,e){for(var t=0,o=r;t<o.length;t++)o[t].then(n,e)})}}();function St(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return w.none();for(var o,r,i,u=t[1],c=e[1],a=Ot(c),s=a.length,f=Math.ceil(s/1024),d=new Array(f),m=0;m<f;++m){for(var l=1024*m,v=Math.min(l+1024,s),h=new Array(v-l),p=l,_=0;p<v;++_,++p)h[_]=a[p].charCodeAt(0);d[m]=(o=h,new(fn.getOrDie("Uint8Array"))(o))}return w.some((r=d,i={type:u},new(fn.getOrDie("Blob"))(r,i)))}var Dt={base64:{versions:["2.0","2.1"],encryptor:{encryptText:function(n){var e=new d.Blob([n],{type:"application/json"}),t=new d.FileReader;return Ye(function(n){t.addEventListener("loadend",function(){return n(Fe.value({encrypted:[t.result]}))}),t.addEventListener("error",function(){return n(Fe.error(t.error))}),t.readAsDataURL(e)})},decryptText:function(n){return(e=n[0],St(e)).fold(function(){return Xe("Could not decode URI")},function(e){var t=new d.FileReader;return Ye(function(n){t.addEventListener("loadend",function(){return n(Fe.value({decrypted:t.result}))}),t.addEventListener("error",function(){return n(Fe.error(t.error.message))}),t.readAsText(e)})});var e}}}};Dt.current=Dt.base64;var Ct=function(t){return function(n,e){for(var t=Y(n),o=0,r=t.length;o<r;o++){var i=t[o],u=n[i];if(e(u,i,n))return w.some(u)}return w.none()}(Dt,function(n){return e=n.versions,-1<I(e,t);var e}).map(function(n){return n.encryptor})},Et=function(){return Dt.current.encryptor},Tt=function(n,e,t){if(e===n)return t;switch(n){case"2.0":return Tt("2.1",e,Le({},o=t,{authorName:o.author}));default:return t}var o},xt="tinycomments",At="2.1",Nt=function(n){return(e=n,bt.getOption(e)).map(function(n){return e=n.replace(/^\s+/g,""),t=e,r=0,""===(o=xt)||!(t.length<o.length)&&t.substr(r,r+o.length)===o;var e,t,o,r}).isSome();var e},kt=function(n){var e,t,o=(t=n,e=bt.get(t),e.replace(/^\s+|\s+$/g,"")).split("|");return 2<o.length?Fe.value({version:o[1],rest:o.slice(2)}):Fe.error("Embedded comments not in expected format.")},Mt=function(n){try{var e=ht(n);return Fe.value(e)}catch(n){return Fe.error("Could not JSON parse conversations.")}},jt=function(n){return(e=n,t=Nt,H(e.dom().childNodes,p(t,tn.fromDom)).map(tn.fromDom)).fold(function(){return qe({conversations:{},commentTag:w.none(),encrypted:{encrypted:[]}})},function(c){return kt(c).fold(Xe,function(n){var e,t,i=n.version,u=n.rest;return(e=i,t=u,Ct(e).fold(function(){return Xe("No Encryptor for version: "+e)},function(n){return n.decryptText(t)})).bindResult(function(n){var e,t,o,r=n.decrypted;return(e=i,t=r,o=Mt(t),e!==At?o.map(function(n){return W(n,function(n){return Le({},n,{comments:P(n.comments,function(n){return Tt(e,At,n)})})})}):o).map(function(n){return{commentTag:w.some(c),conversations:n,encrypted:{encrypted:u}}})})})});var e,t},Rt=function(n){var e,t,o,r=tn.fromDom(d.document.createComment([xt,At].concat(n.encrypted).join("|")));return e=r,t=tn.fromTag("div"),o=tn.fromDom(e.dom().cloneNode(!0)),qn(t,o),t.dom().innerHTML},Ut=function(n){var r,t,e,o=ot(n),i=rt(n),u=(r={},t=w.none(),{get:function(){return ft(r,{})},clear:function(){r={},t=w.none()},addData:function(n,e){r[n]=e},setData:function(n,e){r=n,t=w.some(e)},setEncryptedData:function(n){t=w.some(n)},getEncrypedData:function(){return t},lookupData:e=function(n){return Object.prototype.hasOwnProperty.call(r,n)?w.some(r[n]):w.none()},removeData:function(n){delete r[n]},updateData:function(t,o){return e(t).map(function(n){var e=o(n);return r[t]=e})}}),c=it(n),a=ut(n),s=ct(n),f=Et(),d=function(){return f.encryptText(JSON.stringify(u.get())).mapResult(function(n){return u.setEncryptedData(n)})},m=function(o,r,n,i){return(t=o,u.lookupData(t.conversationUid).fold(function(){return Fe.error("Could not find conversation with uid "+t.conversationUid)},function(e){return H(e.comments,function(n){return n.uid===t.commentUid}).fold(function(){return Fe.error("Could not find comment with uid "+t.commentUid+" in conversation "+t.conversationUid)},function(n){return Fe.value({conversationUid:e.uid,comment:n})})})).fold(function(n){return Xe(n)},function(t){return n(t).bindFuture(function(n){var e;return!0!==n[r]?qe(((e={})[r]=!1,e)):u.updateData(o.conversationUid,i(t)).fold(function(){return Xe("Could not operate on comment ("+r+")")},function(n){return d().mapResult(function(){var n;return(n={})[r]=!0,n})})})});var t};return{create:function(n){var e=A("mce-conversation");return u.addData(e,{uid:e,comments:[{uid:e,author:o,authorName:i,content:n.content,createdAt:n.createdAt,modifiedAt:n.createdAt}]}),d().mapResult(function(){return{conversationUid:e}})},reply:function(n){var e=A("mce-reply"),t={uid:e,author:o,authorName:i,content:n.content,createdAt:n.createdAt,modifiedAt:n.createdAt};return u.updateData(n.conversationUid,function(n){return Le({},n,{comments:n.comments.concat([t])})}).fold(function(){return Xe("Could not reply to uid: "+n.conversationUid)},function(){return d().mapResult(function(){return{commentUid:e}})})},lookup:function(n){return u.lookupData(n.conversationUid).fold(function(){return Xe("Could not find uid: "+n.conversationUid)},function(n){return qe({conversation:n})})},deleteConversation:function(e){return u.lookupData(e.conversationUid).fold(function(){return Xe("Could not find conversation to delete")},function(n){return c({conversationUid:n.uid,comments:n.comments}).bindFuture(function(n){return n.canDelete?(u.removeData(e.conversationUid),d().mapResult(function(){return{canDelete:!0}})):qe({canDelete:!1})})})},deleteAllConversations:function(n){var e=Y(u.get()),o=P(e,function(n){return u.lookupData(n).fold(function(){return Xe("Could not find conversation")},function(n){return c({conversationUid:n.uid,comments:n.comments})})});return Ye(function(t){ce(o).get(function(n){var e=function(n,e){for(var t=0,o=n.length;t<o;++t)if(!0!==e(n[t],t,n))return!1;return!0}(n,function(n){return n.exists(function(n){return n.canDelete})});e&&u.clear(),t(Fe.value({canDelete:e}))})})},deleteComment:function(n){return m(n,"canDelete",a,function(n){return mt(n.comment.uid)})},editComment:function(e){return m(e,"canEdit",function(n){return s(Le({},n,{edit:{modifiedAt:e.modifiedAt,content:e.content}}))},function(n){return lt(e.commentUid,e.content,e.modifiedAt)})},lifecycleHooks:{onSetContent:function(n){jt(tn.fromDom(n.getBody())).get(function(n){return n.fold(function(n){return console.error("Error extracting embedded conversations: "+n)},function(e){e.commentTag.each(function(n){u.setData(e.conversations,e.encrypted),Wn(n)})})})},onGetContent:function(n,e){return u.getEncrypedData().map(function(n){return e+Rt(n)})}}}},Lt=function(n,i,u){n.on("init",function(){n.annotator.register(Oe(),{decorate:function(){return{classes:[ye()],attributes:{}}}}),n.annotator.annotationChanged(Oe(),function(n,e,t){if(n){u.onComment();var o=t.uid,r=t.nodes;i.refreshView(w.some({uid:o,nodes:P(r,tn.fromDom)}))}else u.notOnComment(),i.refreshView(w.none())})})};var It,Pt,Ft=function(n,e){var t,o,r=(t=e,null===(o=n.dom().getAttribute(t))?void 0:o);return void 0===r||""===r?[]:r.split(" ")},Bt=function(n){return void 0!==n.dom().classList},Ht=function(n,e){return r=e,i=Ft(t=n,o="class").concat([r]),Q(t,o,i.join(" ")),!0;var t,o,r,i},Vt=function(n,e){return r=e,0<(i=B(Ft(t=n,o="class"),function(n){return n!==r})).length?Q(t,o,i.join(" ")):Z(t,o),!1;var t,o,r,i},Yt=function(n){0===(Bt(n)?n.dom().classList:Ft(n,"class")).length&&Z(n,"class")},qt=function(e){return(n=Hn(e),t=void 0!==n?n.dom():d.document,w.from(t.activeElement).map(tn.fromDom)).filter(function(n){return e.dom().contains(n.dom())});var n,t},Xt=function(o,r){return function(n){var e,t;r.set(It.Open),e=tn.fromDom(o.getBody()),t=Se(),Bt(e)?e.dom().classList.add(t):Ht(e,t),o.fire("mce-tinycomments-update",{}),je(o,!1)}},Wt=function(e,t){return function(n){qt(tn.fromDom(n.element())).each(function(n){e.focus()}),t.set(It.Closed),function(n,e){Bt(n)?n.dom().classList.remove(e):Vt(n,e);Yt(n)}(tn.fromDom(e.getBody()),Se()),e.fire("mce-tinycomments-update",{})}},zt=function(n,e){n===g.Modern?e.getContainer().querySelector(".mce-sidebar-toolbar .mce-i-conversation").click():Ue(e,"showcomments")},Gt=function(n,e,t){t.get()!==It.Closed&&t.get()!==It.Closing||zt(n,e),je(e,!0)},Jt=function(t,e,o){var n,r;t.ui.registry.addButton("addcomment",{tooltip:Kn.tc_items_addcomment,shortcut:"meta+Alt+M",icon:(n=tinymce,r="5.0.4",n&&1===C(E(n),S(r))?"comment-add":"comment"),onAction:function(){Gt(g.Silver,t,o)}}),t.ui.registry.addMenuItem("addcomment",{text:Kn.tc_items_addcomment,shortcut:"meta+Alt+M",onAction:function(){Gt(g.Silver,t,o)}}),t.ui.registry.addMenuItem("deleteallconversations",{text:Kn.tc_items_deleteall,onAction:function(){Re(t)}}),t.ui.registry.addToggleMenuItem("showcomments",{text:Kn.tc_items_showcomments,onAction:function(){zt(g.Silver,t)},onSetup:function(n){var e=function(){n.setActive(o.get()===It.Open)};return t.on("mce-tinycomments-update",e),e(),function(){t.off("mce-tinycomments-update",e)}}}),t.ui.registry.addSidebar("showcomments",{tooltip:Kn.tc_items_showcomments,icon:"comment",onSetup:function(n){return e.rememberSidebar(tn.fromDom(n.element())),function(){}},onShow:Xt(t,o),onHide:Wt(t,o)})},$t=function(t,e,o){t.addButton("showcomments",{icon:"bubble",tooltip:Kn.tc_items_showcomments,onclick:function(){zt(g.Modern,t)},onPostRender:function(e){t.on("mce-tinycomments-update",function(n){e.control.active(o.get()===It.Open)})}}),t.addButton("addcomment",{tooltip:Kn.tc_items_addcomment,icon:"bubble",onclick:function(n){Gt(g.Modern,t,o)}}),t.addMenuItem("showcomments",{text:Kn.tc_items_showcomments,context:"view",selectable:!0,onclick:function(n){zt(g.Modern,t)},onPostRender:function(e){t.on("mce-tinycomments-update",function(n){e.control.active(o.get()===It.Open)})}}),t.addMenuItem("addcomment",{text:Kn.tc_items_addcomment,context:"insert",onclick:function(n){Gt(g.Modern,t,o)}}),t.addMenuItem("deleteallconversations",{text:Kn.tc_items_deleteall,context:"file",onclick:function(n){Re(t)}}),t.addSidebar("showcomments",{tooltip:Kn.tc_items_showcomments,icon:"conversation",onrender:function(n){e.rememberSidebar(tn.fromDom(n.element()))},onshow:Xt(t,o),onhide:Wt(t,o)})};(Pt=It||(It={}))[Pt.Open=0]="Open",Pt[Pt.Closed=1]="Closed",Pt[Pt.Closing=2]="Closing";var Kt=function(n,e,t){var o=h(It.Closed);e.shortcuts.add("meta+alt+m","TinyComments addComment",function(){Gt(n,e,o)}),(n===g.Modern?$t:Jt)(e,t,o)},Qt=function(i,u){var n,o,t,e,r,c,a=h(!1),s=h(w.none()),f=T(tinymce,"5.0.0")?g.Modern:g.Silver,d=("embedded"===at(n=i)?Ut:dt)(n),m=(o=h(w.none()),t=h(w.none()),{rememberSidebar:function(e){t.set(w.some(e)),o.get().fold(function(){var n=tn.fromHtml('<div aria-busy="true" class="tox-conversations" style="position: relative;">\n  <div class="tox-dialog__busy-spinner">\n  <div class="tox-loading-text">\n      <div>\n      <p>Comments are loading</p>\n      </div>\n  <div class="tox-spinner">\n      <div></div>\n      <div></div>\n      <div></div>\n  </div>\n</div></div>');qn(e,n)},function(n){n.attachTo(e)})},setUi:function(e){o.set(w.some(e)),t.get().each(function(n){Xn(n),e.attachTo(n)})},refreshView:function(e){o.get().fold(function(){},function(n){n.controller.refreshView(e)})},refreshSidebar:function(e,t){o.get().fold(function(){},function(n){n.controller.refreshSidebar(e,t)})},setReadonly:function(e){o.get().each(function(n){return n.controller.setReadonly(e)})},showError:function(e,t){o.get().each(function(n){return n.controller.showError(e,t)})}}),l={translate:tinymce.translate};pe([{type:"js",filename:(e=i,r=u,c=e.settings.tinycomments_js_url,(c?c+"/":r+"/js/")+"tinycomments-sidebar.min.js")}]).get(function(n){return n(f,i,d,s,function(n){m.setUi(n),m.refreshSidebar(s.get(),5),a.set(!0)},l)});var v=Zn(l);return Me(i,m,d,s),Lt(i,m,v),Kt(f,i,m),i.on("init",function(){var n,e,t,o,r;n=f,t=u,o=(e=i).settings.tinycomments_css_url,r=o?o+"/":t+"/css/",tinymce.DOM.styleSheetLoader.load(r+"tinycomments.css",function(){}),n===g.Modern&&(tinymce.DOM.styleSheetLoader.load(r+"tinycomments-tinymce4.css",function(){}),tinymce.DOM.styleSheetLoader.load(r+"tinymce4-icons.css",function(){}),e.dom.loadCSS(r+"tinymce4-content.css")),m.refreshSidebar(w.none(),5)}),i.on("setContent",function(n){n.selection||(d.lifecycleHooks.onSetContent(i),m.refreshView(w.none()))}),i.on("SwitchMode",function(){m.setReadonly(i.readonly)}),i.on("getContent",function(n){var e=!0===n.source_view,t=!0===n.contextual,o=e||t?w.none():d.lifecycleHooks.onGetContent(i,n.content);n.content=o.getOr(n.content)}),{hasLoadedUi:function(){return a.get()}}},Zt=function(n,e){return T(tinymce,"4.8.0")?(ee.error("The tinycomments plugin requires at least 4.8.0 version of TinyMCE."),{}):Qt(n,e)};tinymce.PluginManager.add("tinycomments",Zt)}(window);